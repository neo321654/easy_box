# Техническое задание на разработку Backend для приложения Easy Box

## 1. Обзор

Этот документ описывает требования к REST API серверной части (backend) для мобильного приложения по управлению складом "Easy Box". Приложение позволяет пользователям управлять товарами, заказами и складскими операциями. Бэкенд должен обеспечивать хранение данных, бизнес-логику и аутентификацию пользователей.

## 2. Общие требования

- **Технологический стек:** Рекомендуется использовать современный фреймворк FastAPI.
- **База данных:** Реляционная база данных, такая как PostgreSQL или MySQL.
- **Аутентификация:** JWT (JSON Web Tokens). Токен должен выдаваться при логине и проверяться на всех защищенных эндпоинтах.


---

## 3. Модели данных

### Пользователь (`User`)
| Поле | Тип | Описание |
|---|---|---|
| `id` | UUID | Уникальный идентификатор |
| `name` | String | Имя пользователя |
| `email` | String | Уникальный email, используется для входа |
| `password` | String | Хэшированный пароль |
| `createdAt` | DateTime | Дата создания |
| `updatedAt` | DateTime | Дата обновления |

### Товар (`Product`)
| Поле | Тип | Описание |
|---|---|---|
| `id` | UUID | Уникальный идентификатор |
| `name` | String | Название товара |
| `sku` | String | Уникальный складской идентификатор (SKU) |
| `quantity` | Integer | Количество на складе |
| `location` | String | Местоположение на складе (например, A1-03-05) |
| `imageUrl` | String | URL изображения товара |
| `createdAt` | DateTime | Дата создания |
| `updatedAt` | DateTime | Дата обновления |

### Заказ (`Order`)
| Поле | Тип | Описание |
|---|---|---|
| `id` | UUID | Уникальный идентификатор |
| `customerName` | String | Имя клиента |
| `status` | Enum | Статус заказа (`open`, `inProgress`, `picked`, `cancelled`) |
| `createdAt` | DateTime | Дата создания |
| `updatedAt` | DateTime | Дата обновления |

### Позиция заказа (`OrderLine`)
| Поле | Тип | Описание |
|---|---|---|
| `id` | UUID | Уникальный идентификатор |
| `orderId` | UUID | Внешний ключ к `Order` |
| `productId` | UUID | Внешний ключ к `Product` |
| `productName`| String | Название товара (для истории) |
| `sku` | String | SKU товара (для истории) |
| `quantityToPick`| Integer | Количество для сборки |
| `quantityPicked`| Integer | Фактически собранное количество |

---

## 4. API Эндпоинты

Все эндпоинты, кроме `/auth/login` и `/auth/register`, должны быть защищены JWT-аутентификацией.

### 4.1. Аутентификация (`/auth`)

- **`POST /auth/login`**
  - **Описание:** Аутентификация пользователя.
  - **Тело запроса:** `{ "email": "...", "password": "..." }`
  - **Ответ (200 OK):** `{ "token": "...", "user": { ... } }`
  - **Ответ (401 Unauthorized):** В случае неверных данных.

- **`GET /auth/me`**
  - **Описание:** Получение данных о текущем аутентифицированном пользователе.
  - **Ответ (200 OK):** `{ "id": "...", "name": "...", "email": "..." }`

### 4.2. Товары (`/products`)

- **`GET /products`**
  - **Описание:** Получение списка всех товаров. Поддерживает поиск по SKU.
  - **Query параметры:** `?sku=SKU-123`
  - **Ответ (200 OK):** `[ { ...product }, ... ]`

- **`POST /products`**
  - **Описание:** Создание нового товара.
  - **Тело запроса:** `{ "name": "...", "sku": "...", "location": "..." }`
  - **Ответ (201 Created):** `{ ...product }`

- **`PUT /products/{id}`**
  - **Описание:** Обновление данных товара.
  - **Тело запроса:** `{ "name": "...", "sku": "...", "quantity": ..., "location": "..." }`
  - **Ответ (200 OK):** `{ ...product }`

- **`DELETE /products/{id}`**
  - **Описание:** Удаление товара.
  - **Ответ (204 No Content):**

- **`POST /products/{id}/image`**
  - **Описание:** Загрузка изображения для товара.
  - **Тело запроса:** `multipart/form-data` с файлом изображения.
  - **Ответ (200 OK):** `{ "imageUrl": "..." }`

- **`POST /products/add-stock`**
  - **Описание:** Увеличение количества товара на складе (приёмка).
  - **Тело запроса:** `{ "sku": "...", "quantity": ... }`
  - **Ответ (200 OK):** `{ ...product }`

### 4.3. Заказы (`/orders`)

- **`GET /orders`**
  - **Описание:** Получение списка всех заказов.
  - **Ответ (200 OK):** `[ { ...order, lines: [ ...orderLine ] }, ... ]`

- **`PUT /orders/{id}`**
  - **Описание:** Обновление статуса и позиций заказа (используется при сборке).
  - **Тело запроса:** `{ "status": "...", "lines": [ { "productId": "...", "quantityPicked": ... }, ... ] }`
  - **Ответ (200 OK):** `{ ...order, lines: [ ...orderLine ] }`

## 5. Логика синхронизации

Клиентское приложение поддерживает оффлайн-режим и может отправлять на бэкенд операции, которые накопились в очереди. Бэкенд должен корректно обрабатывать эти запросы, чтобы обеспечить консистентность данных. Например, при обновлении заказа, который был изменен на сервере, может потребоваться логика слияния изменений. На первом этапе достаточно простой обработки по принципу "последнее изменение выигрывает".
