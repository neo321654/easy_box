# План отладки бэкенда

Этот документ отслеживает шаги по диагностике и исправлению проблем с бэкендом Django.

## Фаза 1: Диагностика

- [x] Проверить, отвечает ли сервер на базовые запросы (`curl -I http://38.244.208.106:8000`).
- [ ] Проверить эндпоинт админ-панели (`curl http://3.244.208.106:8000/admin/`).
- [x] Проверить эндпоинты API на доступность (например, `curl http://38.244.208.106:8000/api/products/`).
- [ ] Проанализировать `settings.py` на предмет потенциальных проблем с конфигурацией (база данных, `SECRET_KEY`, `DEBUG` флаг).
- [ ] Проанализировать `Dockerfile` и `docker-compose.yml` на предмет проблем с запуском сервера.

## Фаза 2: Исправление

- [x] **Проблема:** Неправильная конфигурация URL-адресов API.
  - [x] **Решение:** Изменить `backend/urls.py` и `api/urls.py`, чтобы все эндпоинты API находились по префиксу `/api/`.
  - [x] *Шаг 1: Добавить префикс `/api/` в `backend/urls.py`.*
  - [x] *Шаг 2: Убрать лишние префиксы из `api/urls.py` и добавить слэш к `auth/token/`.*
- [x] **Проблема:** `DEBUG = True` в продакшене.
  - [x] **Решение:** Установить `DEBUG = False` в `settings.py`.
- [x] **Проблема:** Отсутствует таблица `authtoken_token` в базе данных.
  - [x] **Решение:** Добавить команду `migrate` в `Dockerfile`.
- [x] **Проблема:** Аутентификация по `email` не работает.
  - [x] **Решение:** Создать кастомный сериализатор для `ObtainAuthToken` и использовать `email` в качестве `username`.
- [x] **Проблема:** Не создаются строки заказа.
  - [x] **Решение:** Исправить `OrderSerializer` для правильной обработки вложенных строк заказа.
- [x] **Проблема:** Ошибка валидации `OrderLineSerializer`.
  - [x] **Решение:** Исключить поле `order` из `OrderLineSerializer`.
- [x] **Проблема:** Неправильная обработка вложенных `OrderLine`.
  - [x] **Решение:** Использовать `PrimaryKeyRelatedField` для `product` в `OrderLineSerializer`.

## Фаза 3: Тестирование функциональности

- [x] **Аутентификация:**
  - [x] Получить токен (`/auth/token`).
  - [x] Получить доступ к защищенному эндпоинту с токеном.
- [x] **Продукты (Products):**
  - [x] Получить список продуктов (`GET /api/products/`).
  - [x] Создать новый продукт (`POST /api/products/`).
  - [x] Получить, обновить, удалить продукт (`GET`, `PUT`, `DELETE /api/products/{id}/`).
- [x] **Заказы (Orders):**
  - [x] Получить список заказов (`GET /api/orders/`).
  - [x] Создать новый заказ (`POST /api/orders/`).
  - [x] Получить, обновить, удалить заказ (`GET`, `PUT`, `DELETE /api/orders/{id}/`).
- [ ] **Загрузка изображений:**
  - [ ] Проверить загрузку изображения при создании/обновлении продукта.

## Фаза 4: Завершение

- [ ] Удалить файл `DEBUG_PLAN.md`.
- [ ] Закоммитить и запушить исправления.
